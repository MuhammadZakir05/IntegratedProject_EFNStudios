<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact & Help - Scam Awareness Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="page">
        <div class="scenario-header">
            <a href="dashboard.html" class="back-btn">
                <svg class="icon" viewBox="0 0 24 24">
                    <line x1="19" y1="12" x2="5" y2="12"/>
                    <polyline points="12 19 5 12 12 5"/>
                </svg>
                <span>Back</span>
            </a>
            <h1 class="text-center mb-2">Contact & Help</h1>
            <p class="text-center text-gray text-sm">Report scams or get assistance in Singapore</p>
        </div>

        <div class="container">
            <div class="info-card" style="background: linear-gradient(to bottom right, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1)); border-color: rgba(239, 68, 68, 0.3);">
                <h2 class="mb-4 text-red">ðŸš¨ Report a Scam (Singapore)</h2>
                <p class="text-sm mb-4">If you suspect you have been scammed, contact these official channels immediately:</p>
                
                <div class="info-item">
                    <div style="flex:1;">
                        <p class="text-sm mb-1"><strong>National Anti-Scam Helpline</strong></p>
                        <p class="text-xs text-gray mb-1">For advice on scams</p>
                        <p class="text-lg text-white font-bold">ðŸ“ž 1800-722-6688</p>
                    </div>
                </div>

                <div class="info-item">
                    <div style="flex:1;">
                        <p class="text-sm mb-1"><strong>Singapore Police Force (SPF)</strong></p>
                        <p class="text-xs text-gray mb-1">Report crimes or emergencies</p>
                        <p class="text-sm text-white">Emergency: <strong>999</strong></p>
                        <p class="text-sm text-white">Hotline: <strong>1800-255-0000</strong></p>
                        <p class="text-xs text-blue mt-1" onclick="window.open('https://www.police.gov.sg/iwitness', '_blank')" style="cursor:pointer;">Submit Report Online (I-Witness)</p>
                    </div>
                </div>

                <div class="info-item">
                    <div style="flex:1;">
                        <p class="text-sm mb-1"><strong>ScamShield</strong></p>
                        <p class="text-xs text-gray mb-1">Check and report scam numbers/messages</p>
                        <p class="text-xs text-blue mt-1" onclick="window.open('https://www.scamshield.org.sg', '_blank')" style="cursor:pointer;">Visit scamshield.org.sg</p>
                    </div>
                </div>
            </div>

            <div class="form-card mt-6">
                <h2 class="mb-4">Send Us a Message</h2>

                <div class="input-group">
                    <label class="input-label">Name</label>
                    <input type="text" id="contact-name" class="input-field" placeholder="Your name" style="padding-left: 1rem;">
                </div>

                <div class="input-group">
                    <label class="input-label">Email</label>
                    <input type="email" id="contact-email" class="input-field" placeholder="Your email" style="padding-left: 1rem;">
                </div>

                <div class="input-group">
                    <label class="input-label">Subject</label>
                    <input type="text" id="contact-subject" class="input-field" placeholder="What's this about?" style="padding-left: 1rem;">
                </div>

                <div class="input-group">
                    <label class="input-label">Message</label>
                    <textarea id="contact-message" style="width: 100%; padding: 1rem; background: #1f2937; border: 1px solid #374151; border-radius: 0.75rem; color: white; font-size: 1rem; outline: none; font-family: inherit; min-height: 150px; resize: vertical;" placeholder="Describe your situation or question..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="handleSubmit()">Send Message</button>

                <div id="contact-success" class="success-message hidden"></div>
                <div id="contact-error" class="error-message hidden"></div>
            </div>

            <div class="info-card mt-6">
                <h2 class="mb-4">ðŸ“š Help Resources</h2>
                
                <div class="collapsible-card" style="border-radius: 0.75rem; margin-bottom: 1rem;">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <p class="text-sm"><strong>Steps to take if you've been scammed</strong></p>
                        <svg class="icon chevron-icon" viewBox="0 0 24 24" style="color: #9ca3af; transition: transform 0.3s;">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content">
                        <ol style="list-style: decimal; padding-left: 1.5rem;" class="text-sm text-gray">
                            <li class="mb-2"><strong>Call your bank immediately</strong> to freeze your accounts.</li>
                            <li class="mb-2">File a police report via the SPF E-Services or at a Neighbourhood Police Centre.</li>
                            <li class="mb-2">Stop all communication with the scammer.</li>
                            <li class="mb-2">Warn your family and friends about the scam tactics.</li>
                            <li class="mb-2">Report the number to ScamShield.</li>
                        </ol>
                    </div>
                </div>

                <div class="collapsible-card" style="border-radius: 0.75rem;">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <p class="text-sm"><strong>Visit ScamAlert.sg</strong></p>
                        <svg class="icon chevron-icon" viewBox="0 0 24 24" style="color: #9ca3af; transition: transform 0.3s;">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content">
                        <p class="text-sm text-gray mb-3">ScamAlert.sg is run by the National Crime Prevention Council. It contains up-to-date stories and alerts on the latest scams in Singapore.</p>
                        <a href="https://www.scamalert.sg" target="_blank" class="text-link text-sm">Go to ScamAlert.sg &rarr;</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // 1. Check Login using App.js
        const currentUser = getCurrentUser();
        if (!currentUser) {
            window.location.href = 'login.html';
        }

        // 2. Handle Form Submission to RestDB
        async function handleSubmit() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const subject = document.getElementById('contact-subject').value;
            const message = document.getElementById('contact-message').value;

            // Basic validation using App.js helper
            if (!name || !email || !subject || !message) {
                showError('contact-error', 'Please fill in all fields');
                return;
            }

            if (!email.includes('@')) {
                showError('contact-error', 'Please enter a valid email address');
                return;
            }

            // --- RESTDB CONNECTION CODE ---
            const API_KEY = '69786cc753d66e164e1956c2'; // Using your existing key
            const URL = 'https://defngame-345c.restdb.io/rest/contacts'; // Target new collection

            const data = {
                name: name,
                email: email,
                subject: subject,
                message: message,
                timestamp: new Date().toISOString(),
                username: currentUser.username // Track which user sent it
            };

            try {
                const response = await fetch(URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "x-apikey": API_KEY,
                        "cache-control": "no-cache"
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showSuccess('contact-success', 'Message sent! We will respond shortly.');
                    // Clear form
                    document.getElementById('contact-name').value = '';
                    document.getElementById('contact-email').value = '';
                    document.getElementById('contact-subject').value = '';
                    document.getElementById('contact-message').value = '';
                } else {
                    throw new Error('Failed to send');
                }
            } catch (error) {
                console.error("RestDB Error:", error);
                showError('contact-error', 'Database connection error. Please try again.');
            }
        }
    </script>
</body>
</html>