<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Scam Awareness Simulator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="page">
        <div class="container">
            <div class="logo-container">
                <div class="logo-icon">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                </div>
                <h1>Reset Password</h1>
                <p class="text-sm text-gray">Enter your email to receive a verification code</p>
            </div>

            <div class="form-card">
                <a href="login.html" class="back-btn">
                    <svg class="icon" viewBox="0 0 24 24">
                        <line x1="19" y1="12" x2="5" y2="12"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                    <span>Back to Login</span>
                </a>

                <!-- Step 1: Email -->
                <div id="step-email">
                    <div class="input-group">
                        <label class="input-label">Email Address</label>
                        <div class="input-wrapper">
                            <svg class="input-icon icon" viewBox="0 0 24 24">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <polyline points="22,6 12,13 2,6"/>
                            </svg>
                            <input type="email" id="forgot-email" class="input-field" placeholder="Enter your email">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="sendCode()">Send Verification Code</button>
                </div>

                <!-- Step 2: Verification Code -->
                <div id="step-code" class="hidden">
                    <div style="background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <p class="text-sm text-center" style="color: #60a5fa;">
                            A verification code has been sent to <strong id="email-display"></strong>
                        </p>
                        <p class="text-xs text-center text-gray mt-2">
                            Demo code: <strong id="demo-code" class="text-white"></strong>
                        </p>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Verification Code</label>
                        <input type="text" id="verify-code" class="input-field" placeholder="000000" maxlength="6" style="padding-left: 1rem; text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                    </div>

                    <button class="btn btn-primary mb-3" onclick="verifyCode()">Verify Code</button>
                    <button class="btn btn-secondary" onclick="sendCode()">Resend Code</button>
                </div>

                <!-- Step 3: Reset Password -->
                <div id="step-reset" class="hidden">
                    <div class="input-group">
                        <label class="input-label">New Password</label>
                        <div class="input-wrapper">
                            <svg class="input-icon icon" viewBox="0 0 24 24">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                            <input type="password" id="new-password" class="input-field" placeholder="Enter new password">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Confirm New Password</label>
                        <div class="input-wrapper">
                            <svg class="input-icon icon" viewBox="0 0 24 24">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                            <input type="password" id="confirm-password" class="input-field" placeholder="Confirm new password">
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="resetPassword()">Reset Password</button>
                </div>

                <!-- Step 4: Success -->
                <div id="step-success" class="hidden">
                    <div class="text-center">
                        <div style="width: 5rem; height: 5rem; background: rgba(16, 185, 129, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                            <svg class="icon" viewBox="0 0 24 24" style="width: 3rem; height: 3rem; color: #10b981; stroke-width: 3;">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="9 12 11 14 15 10"/>
                            </svg>
                        </div>

                        <h3 class="mb-2">Password Reset Successful!</h3>
                        <p class="text-gray mb-6">You can now log in with your new password</p>

                        <a href="login.html" class="btn btn-primary">Back to Login</a>
                    </div>
                </div>

                <div id="forgot-error" class="error-message hidden"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let userEmail = '';
        let generatedCode = '';

        async function sendCode() {
            const email = document.getElementById('forgot-email').value;
            if (!email) { showError('forgot-error', 'Enter email'); return; }

            // 1. Check if user exists in DB
            // (We assume DB.updatePassword returns false if email not found later, 
            // but for a better UX let's just proceed to "simulation")
            
            // Generate Code
            generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
            userEmail = email;

            // Show UI
            document.getElementById('step-email').classList.add('hidden');
            document.getElementById('step-code').classList.remove('hidden');
            document.getElementById('email-display').textContent = email;
            document.getElementById('demo-code').textContent = generatedCode;
        }

        function verifyCode() {
            const code = document.getElementById('verify-code').value;
            if (code !== generatedCode) { showError('forgot-error', 'Invalid code'); return; }
            
            document.getElementById('step-code').classList.add('hidden');
            document.getElementById('step-reset').classList.remove('hidden');
        }

        async function resetPassword() {
            const newPass = document.getElementById('new-password').value;
            const confirm = document.getElementById('confirm-password').value;

            if (newPass.length < 8) { showError('forgot-error', 'Too short'); return; }
            if (newPass !== confirm) { showError('forgot-error', 'Mismatch'); return; }

            // Update in DB
            const success = await DB.updatePassword(userEmail, newPass);
            
            if(success) {
                document.getElementById('step-reset').classList.add('hidden');
                document.getElementById('step-success').classList.remove('hidden');
            } else {
                showError('forgot-error', 'Email not found in database.');
            }
        }
    </script>
</body>
</html>
