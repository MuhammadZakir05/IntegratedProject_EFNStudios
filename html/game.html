<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-frame">
        <div id="app-content" style="display:flex; flex-direction:column;">
            
            <div id="screen-briefing">
                <h2 style="text-align:center;">Scenario Briefing</h2>
                <div class="card">
                    <p style="color:#888; font-size:0.8rem; margin-bottom:5px;">Situation</p>
                    <div id="br-situation">...</div>
                </div>
                <div class="card" style="border-color:#f97316;">
                    <b style="color:#f97316;">ðŸ’¡ Tip</b>
                    <p id="br-tip" style="margin:0; font-size:0.9rem;">...</p>
                </div>
                <button class="btn btn-primary" onclick="startGame()">Start</button>
                <a href="simulation.html" class="btn btn-outline">Cancel</a>
            </div>

            <div id="screen-game" class="hidden" style="flex:1; display:flex; flex-direction:column;">
                <div style="text-align:center; padding:10px;">Incoming Message</div>
                <div id="game-body" style="flex:1; background:white; color:black; padding:20px; border-radius:15px; overflow-y:auto;"></div>
                <div id="game-opts" style="margin-top:15px;"></div>
            </div>

        </div>
    </div>
    <script src="db.js"></script>
    <script src="scenarios.js"></script>
    <script>
        let sid = localStorage.getItem('current_scenario');
        let s = scenarios.find(x => x.id === sid);
        
        document.getElementById('br-situation').innerText = s.briefing.situation;
        document.getElementById('br-tip').innerText = s.briefing.tip;

        function startGame() {
            document.getElementById('screen-briefing').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            let body = document.getElementById('game-body');
            body.innerHTML = s.content.body;
            let opts = document.getElementById('game-opts');
            s.options.forEach(o => {
                let btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = o.text;
                btn.style.background = o.type === 'correct' ? '#22c55e' : (o.type==='wrong'?'#ef4444':'#f59e0b');
                btn.onclick = () => finish(o);
                opts.appendChild(btn);
            });
        }

        async function finish(choice) {
            let passed = choice.type !== 'wrong';
            await DB.saveProgress(passed ? 0 : s.content.cost, s.id, passed ? 'passed' : 'failed');
            alert(passed ? "Safe!" : "Scammed!");
            window.location.href = 'home.html';
        }
    </script>
</body>
</html>